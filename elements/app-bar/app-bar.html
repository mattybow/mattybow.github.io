<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-fa-icon-button/paper-fa-icon-button.html">
<link rel="import" href="../menu-hamburger/menu-hamburger.html">
<polymer-element name="app-bar" attributes="items itemPos logo logoPos social color">
	<template>
		<style>
			:host {
				display: block;
				background:transparent;
				z-index:100;
				position:absolute;
				width:100%;
			}
			.right{
				right:0px;
				margin-right:10px;
			}
			.left{
				left:0px;
				margin-left:20px;
			}
			.item-wrapper{
				padding-top:20px;
				display:inline-block;
				position:absolute;
				white-space:nowrap;
			}
			paper-button::shadow #ripple ,paper-icon-button::shadow #ripple{
			    color: #aaa;
			}
			paper-button::shadow >*{
				text-transform:none;
			}
			paper-button::shadow #content{

			}
			.logo{
				padding-top:20px;
				padding-left:30px;
				font-size:30px;
				font-weight:bolder;
				display:inline-block;
			}
			.social{
				display:inline-block;
				vertical-align: top;
			}
			paper-fa-icon-button::shadow .button{
			  width:35px;
			  height:35px;
			}
			paper-fa-icon-button::shadow .fa{
				width:20px;
				height:20px;
				font-size:20px;
			}
			paper-fa-icon-button::shadow paper-ripple{
				height:35px;
				width:35px;
			}
			.stage{
				display:inline-block;
				overflow:hidden;
			}
			paper-fa-icon-button, paper-button{
				-webkit-transition-property:transform;
				-webkit-transition-duration:0.4s;
				-webkit-transform:translate3d(0,0,0);
				transition-property:transform;
				transition-duration:0.4s;
				transform:translate3d(0,0,0);
			}
			.txfm{
				-webkit-transition-property:transform;
				-webkit-transition-duration:0.4s;
				-webkit-transform:translate3d(0,-50px,0);
				transition-property:transform;
				transition-duration:0.4s;
				transform:translate3d(0,-50px,0);
			}
			.hamburger-hider{
				overflow:hidden;
				display:inline-block;
				position:fixed;
				right: -50px;
				top: 20px;
				padding: 0px 10px;
				-webkit-transition:right .05s;
				transition:right .05s;
			}
			.hamburger-hider.show{
				right:20px;
			}
			menu-hamburger{
				-webkit-transition:left .3s;
				transition:left .3s;
				position: relative;
				top: 0px;
				left:40px;
			}
			menu-hamburger.show{
				left: 0px;
			}

		</style>
		<div class="{{itemPos}} item-wrapper" style="color:{{color}}">
			<template repeat={{items}}>
				<div class="stage">
				<paper-button label="{{}}" id="{{}}"></paper-button>
				</div>
			</template>
			<div class="social">
				<template repeat="{{social as social}}">
					<div class="stage">
						<paper-fa-icon-button faclass="{{social}}" class="{{social}}" size="35" facolor="{{color}}"></paper-fa-icon-button>
					</div>
				</template>
			</div>
		</div>
		<div class="hamburger-hider">
			<menu-hamburger></menu-hamburger>
		</div>
		
	</template>
	<script>
		Polymer('app-bar', {
			created:function(){
				this.items=[];
				this.social=[];
				this.itemsHidden=false;
				this.color='black';
			},
			domReady:function(){
				this.scrollObj = document.getElementsByClassName('parallax')[0];
				if(this.scrollObj) this.setScrollListener();
			},
			setScrollListener:function(){
				this.scrollObj.addEventListener('scroll', this.scrollHandler.bind(this));
			},
			scrollHandler:function(element){
				var position = this.scrollObj.scrollTop;
				// console.log(position);
				if(position>=320 && !this.itemsHidden){
					this.transitionItems('add');
				} else if (position<=320 && this.itemsHidden){
					this.transitionItems('remove');
				}
			},
			transitionItems:function(action){
				var shadow = document.querySelector('app-bar').shadowRoot;
				var buttons = shadow.getElementsByTagName('paper-button');
				var socialButtons = shadow.getElementsByTagName('paper-fa-icon-button');
				var that = this;
				if(action==='add'){
					var preTime = this.addClass(buttons,socialButtons);
					setTimeout(function(){
						that.showHamburger(shadow);
					}.bind(this),preTime);
					this.itemsHidden=true;
				} else if (action==='remove'){
					this.hideHamburger(shadow);
					this.removeClass(buttons);
					this.removeClass(socialButtons);
					this.itemsHidden=false;
				}
			},
			addClass:function(){
				var count=1;
				if(arguments.length){
					[].forEach.call(arguments,function(elements,index){
						[].forEach.call(elements,function(el){
							setTimeout(function(){
								el.classList.add('txfm');
							}.bind(this),count);
							count+=50;
						});
					});
				}
				return count;
			},
			removeClass:function(els){
				[].forEach.call(els,function(el){
					el.classList.remove('txfm');
				});
			},
			showHamburger:function(shadow){
				shadow.getElementsByClassName('hamburger-hider')[0].classList.add('show');
				shadow.getElementsByTagName('menu-hamburger')[0].classList.add('show');
			},
			hideHamburger:function(shadow){
				shadow.getElementsByClassName('hamburger-hider')[0].classList.remove('show');
				shadow.getElementsByTagName('menu-hamburger')[0].classList.remove('show');
			}

		});
	</script>
</polymer-element>